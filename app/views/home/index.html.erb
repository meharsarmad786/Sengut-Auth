<% if user_signed_in? %>
  <!-- Authenticated User Dashboard -->
  <div class="container mt-4">
    <div class="row">
      <div class="col-md-12">
        <div class="welcome-header mb-4">
          <h1 class="display-4">
            <i class="bi bi-person-circle"></i>
            Welcome back, <%= current_user.first_name %>!
          </h1>
          <p class="lead text-muted">
            <i class="bi bi-calendar-event"></i> Age: <%= current_user.age %> years
            <% if current_user.age_group %>
              â€¢ <i class="bi bi-people"></i> Age Group: <%= current_user.age_group.name %>
            <% end %>
          </p>
        </div>
      </div>
    </div>

    <!-- User Stats Cards -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card stats-card text-center">
          <div class="card-body">
            <i class="bi bi-building display-4 mb-2"></i>
            <h3><%= @user_stats[:organizations_count] %></h3>
            <p class="mb-0">Organizations</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stats-card text-center">
          <div class="card-body">
            <i class="bi bi-activity display-4 mb-2"></i>
            <h3><%= @user_stats[:activities_count] %></h3>
            <p class="mb-0">Activities</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stats-card text-center">
          <div class="card-body">
            <i class="bi bi-people display-4 mb-2"></i>
            <h3><%= @user_stats[:age_group] || 'N/A' %></h3>
            <p class="mb-0">Age Group</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stats-card text-center">
          <div class="card-body">
            <% if @user_stats[:requires_consent] %>
              <i class="bi bi-shield-exclamation display-4 mb-2"></i>
              <h5 class="text-warning">Consent Required</h5>
            <% else %>
              <i class="bi bi-shield-check display-4 mb-2"></i>
              <h5 class="text-success">Fully Verified</h5>
            <% end %>
            <p class="mb-0">Status</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Organizations and Activities -->
    <div class="row">
      <div class="col-md-8">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="bi bi-building"></i> My Organizations
            </h5>
            <%= link_to "View All", organizations_path, class: "btn btn-sm btn-outline-primary" %>
          </div>
          <div class="card-body">
            <% if @organizations.any? %>
              <div class="row">
                <% @organizations.each do |organization| %>
                  <div class="col-md-6 mb-3">
                    <div class="card organization-card">
                      <div class="card-body">
                        <h6 class="card-title">
                          <%= link_to organization.name, organization_path(organization), class: "text-decoration-none" %>
                        </h6>
                        <p class="card-text text-muted small">
                          <%= truncate(organization.description, length: 60) %>
                        </p>
                        <span class="badge bg-info">
                          <%= current_user.organization_role(organization).capitalize %>
                        </span>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="text-center py-4">
                <i class="bi bi-building text-muted display-4 mb-3"></i>
                <p class="text-muted mb-3">You haven't joined any organizations yet.</p>
                <%= link_to "Browse Organizations", organizations_path, class: "btn btn-primary" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="bi bi-activity"></i> Recent Activities
            </h5>
          </div>
          <div class="card-body">
            <% if @recent_activities.any? %>
              <div class="list-group list-group-flush">
                <% @recent_activities.each do |activity| %>
                  <div class="list-group-item border-0 px-0">
                    <div class="d-flex w-100 justify-content-between">
                      <small class="text-muted">
                        <%= activity.activity_description %>
                      </small>
                      <small class="text-muted">
                        <%= time_ago_in_words(activity.created_at) %> ago
                      </small>
                    </div>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="text-center py-3">
                <i class="bi bi-activity text-muted display-6 mb-2"></i>
                <p class="text-muted mb-0">No recent activities.</p>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

<% else %>
  <!-- Guest User Landing Page -->
  <div class="hero-section bg-primary text-white py-5">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h1 class="display-4 fw-bold mb-4">
            <i class="bi bi-shield-check"></i>
            Sengut Auth
          </h1>
          <p class="lead mb-4">
            A comprehensive authentication and access control system with organization-based permissions and age-appropriate participation rules.
          </p>
          <div class="mb-4">
            <%= link_to "Get Started", new_user_registration_path, class: "btn btn-light btn-lg me-3" %>
            <%= link_to "Learn More", "#features", class: "btn btn-outline-light btn-lg" %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="feature-list">
            <div class="feature-item mb-3">
              <i class="bi bi-building-check text-warning me-2"></i>
              <strong>Organization-Based Access Control</strong>
            </div>
            <div class="feature-item mb-3">
              <i class="bi bi-person-check text-warning me-2"></i>
              <strong>Age-Based Participation Rules</strong>
            </div>
            <div class="feature-item mb-3">
              <i class="bi bi-shield-check text-warning me-2"></i>
              <strong>Parental Consent Management</strong>
            </div>
            <div class="feature-item mb-3">
              <i class="bi bi-graph-up text-warning me-2"></i>
              <strong>Analytics & Reporting</strong>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Features Section -->
  <div class="container my-5" id="features">
    <div class="row">
      <div class="col-md-12 text-center mb-5">
        <h2 class="display-5 fw-bold">Key Features</h2>
        <p class="lead text-muted">Designed for secure, age-appropriate, and organized participation</p>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="card h-100">
          <div class="card-body">
            <div class="feature-icon text-primary mb-3">
              <i class="bi bi-building display-4"></i>
            </div>
            <h4>Organization Management</h4>
            <p class="text-muted">
              Create and manage organizations with role-based permissions. 
              Admins, moderators, and members have different access levels.
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-6 mb-4">
        <div class="card h-100">
          <div class="card-body">
            <div class="feature-icon text-success mb-3">
              <i class="bi bi-person-check display-4"></i>
            </div>
            <h4>Age-Based Rules</h4>
            <p class="text-muted">
              Automatic age verification and appropriate content filtering. 
              Different participation rules for different age groups.
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-6 mb-4">
        <div class="card h-100">
          <div class="card-body">
            <div class="feature-icon text-warning mb-3">
              <i class="bi bi-shield-exclamation display-4"></i>
            </div>
            <h4>Parental Consent</h4>
            <p class="text-muted">
              Secure parental consent workflow for minor users. 
              Email verification and consent tracking.
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-6 mb-4">
        <div class="card h-100">
          <div class="card-body">
            <div class="feature-icon text-info mb-3">
              <i class="bi bi-graph-up display-4"></i>
            </div>
            <h4>Analytics & Reporting</h4>
            <p class="text-muted">
              Comprehensive analytics dashboard for organization admins. 
              Track participation and engagement metrics.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Organizations Preview -->
  <div class="bg-light py-5">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center mb-4">
          <h2 class="display-6 fw-bold">Active Organizations</h2>
          <p class="lead text-muted">Join these organizations to get started</p>
        </div>
      </div>

      <div class="row">
        <% if @public_organizations.any? %>
          <% @public_organizations.each do |organization| %>
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card organization-card h-100">
                <div class="card-body">
                  <h5 class="card-title"><%= organization.name %></h5>
                  <p class="card-text text-muted">
                    <%= truncate(organization.description, length: 100) %>
                  </p>
                  <div class="mt-auto">
                    <small class="text-muted">
                      <i class="bi bi-people"></i> <%= organization.members_count %> members
                    </small>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="col-12 text-center py-4">
            <i class="bi bi-building text-muted display-4 mb-3"></i>
            <p class="text-muted">No organizations available yet.</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Age Groups Section -->
  <div class="container my-5">
    <div class="row">
      <div class="col-md-12 text-center mb-4">
        <h2 class="display-6 fw-bold">Age Groups</h2>
        <p class="lead text-muted">Different participation rules for different age groups</p>
      </div>
    </div>

    <div class="row">
      <% if @age_groups.any? %>
        <% @age_groups.each do |age_group| %>
          <div class="col-md-4 mb-4">
            <div class="card">
              <div class="card-body text-center">
                <h5 class="card-title"><%= age_group.name %></h5>
                <p class="card-text">
                  <strong><%= age_group.age_range %></strong>
                </p>
                <p class="card-text text-muted small">
                  <%= age_group.description %>
                </p>
                <% if age_group.requires_parental_consent? %>
                  <span class="badge bg-warning text-dark">
                    <i class="bi bi-shield-exclamation"></i> Parental Consent Required
                  </span>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="col-12 text-center py-4">
          <i class="bi bi-people text-muted display-4 mb-3"></i>
          <p class="text-muted">No age groups configured yet.</p>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
